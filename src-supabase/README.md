# Speculations

Speculations is an Edge Function that makes requests to OpenAI to generate ironic sentences.

## Rules for Sentence Generation

The sentences generated by the Speculations function adhere to the following rules for [OpenAI](https://platform.openai.com/docs/guides/text-generation/chat-completions-api):

- It must always return 3 sentences in English, regardless of the context language.
- The sentences must include the name of the project.
- Each sentence must be no more than 200 characters long.
- The return must be in JSON format, with the key 'sentences' containing an array of strings.
- When it is not possible to create sentences, return an empty array.

## Prerequisites

Before you start, make sure you have installed the following:

- [Supabase CLI](https://supabase.com/docs/guides/cli)
- [Deno](https://deno.land/#installation)
- [NPM](https://www.npmjs.com/get-npm)

### Environment Variables on Your Computer

```shell
export SUPABASE_ACCESS_TOKEN=
```

## Configuration

Follow the steps below to configure and deploy your function.

* **Variáveis de Ambiente:** Crie uma variável de ambiente chamada `OPENAI_API_KEY` nas Edge Functions do Supabase para autenticar chamadas de API.
* **Deploy da Function:** Faça deploy da function em sua conta do Supabase. Para isso, use o comando `npm run deploy:generate-project-speculations`.
* **Obtenção da URL da Function:** Para obter a URL da sua function, acesse o console do Supabase e procure por **Edges**. Copie a URL fornecida.
* **Executar Migration:** Execute a migration para configurar inicialmente seu projeto ou atualizar o banco de dados.

```shell
# This command is essential for pointing your computer to the remote environment
supabase link [project reference here]
 
# Executes the migrations, confirmation is required
npx supabase db push 

```


* **Configure Edge Function URL:** Execute the following query to configure your Edge Function's URL:


```sql
SELECT public.set_edge_function_url_secret(
    'PROJECT_SPECULATIONS_API_URL', -- do not change this line
    'YOUR EDGE URL HERE'  -- replace 'YOUR EDGE URL HERE' with the URL obtained earlier
) as result;

``````

* **Temporary `set_edge_function_url_secret` function:** This function is temporary, which means it will be deleted after execution.


### HTTP Codes.

| HTTP Code | Description              | Details                                                                    |
|-----------|--------------------------|----------------------------------------------------------------------------|
| 200       | OK                       | When the sentences are successfully generated.                             |
| 400       | Bad Request              | Any error from the API that results from a malformed or invalid request.   |
| 405       | Method Not Allowed       | When the method used in the request is not POST.                           |
| 406       | Not Acceptable           | When the specified project in the request does not exist or cannot be found. |


#### Success Response

```json
{
    "sentences": [
        "CloudCanvas was supposed to be the ultimate canvas for digital artists, but it ended up being just a cloud of disappointment.",
        "The sky was the limit for CloudCanvas, but it seems like they got lost in the fog of their own ambitions.",
        "In a world full of clouds, CloudCanvas tried to stand out, but it looks like their uniqueness got lost in the storm."
    ]
}

```

## Technologies

- Supabase
- OpenAI
- Deno
- Typescript
- PostgreSQL

## You Might Need

- [Supabase Migrations](https://supabase.com/docs/reference/cli/supabase-migration)

